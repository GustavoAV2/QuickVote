<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat</title>

    <!-- MAIN CSS -->
    <link rel="stylesheet" href="static/css/bootstrap.min.css">
    <link rel="stylesheet" href="static/css/font-awesome.min.css">
    <link rel="stylesheet" href="static/css/aos.css">
    <link rel="stylesheet" href="static/css/tooplate-gymso-style.css">
    <link rel="stylesheet" href="static/css/tooplate-wave-cafe.css">

    <!-- SCRIPTS -->
    <script src="static/js/jquery.min.js"></script>
    <script src="static/js/bootstrap.min.js"></script>
    <script src="static/js/aos.js"></script>
    <script src="static/js/smoothscroll.js"></script>
    <script src="static/js/custom.js"></script>
</head>
<body>
    <div class="container">
        <textarea id="room" cols="70" rows="15"></textarea> <br/>
        <input id="text" type="text">

        <input id="button" class="btn btn-primary" type="button" value="Enviar">
    </div>

    <script>
        var room_number = {{ room }};
        var route = 'ws://' + window.location.host + '/ws/room/' + room_number.number + '/';

        var chatSocket = new WebSocket(route);

        chatSocket.onmessage = function(e){
            var data = JSON.parse(e.data);
            var message = data['message'];
            document.querySelector('#room').value += (message + '\n');
        }

        chatSocket.onclose = function(e){
            console.error('Chat encerrado!');
        }

        document.querySelector('#text').focus();
        document.querySelector('#text').onkeyup = function(e){
            if (e.keycode == 13){
                document.querySelector('#button').click();
            }
        };

        document.querySelector('#button').onclick = function(e){
            var messageInput = document.querySelector('#text');
            var msg = document.querySelector('#text').value;

            chatSocket.send(JSON.stringify({
                'message': msg
            }));

            messageInput.value = '';
        };
    </script>
</body>
</html>